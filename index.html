<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal de Instruções - COGESPA</title>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

    <style>
        @import url('https://fonts.googleapis.com/css?family=Montserrat:300,500,700');

        :root {
            --color-tertiary: #282828;
            --color-quaternary: #787878;
            --color-senary: #22748b;
            --color-septenary: #00a3c5;
            --background-primary: #00a3c5;
            --background-senary: #f9f9f9;
            --border-primary: #00a3c5;
            --border-octonary: #dddddd;
        }

        * { box-sizing: border-box; }

        body {
            font-family: "Montserrat", Arial, Helvetica, sans-serif;
            background-color: #fff;
            color: var(--color-tertiary);
            margin: 0; padding: 0;
        }

        .navbar-custom {
            background-color: #f8f8f8;
            border-bottom: 1px solid #e7e7e7;
            margin-bottom: 0; min-height: 40px;
        }

        .header-main {
            padding: 15px 0;
            background-color: #fff;
            border-bottom: 2px solid var(--color-septenary);
        }

        .header-title-container {
            display: flex; justify-content: space-between; align-items: center;
        }

        .portal-title {
            color: var(--color-septenary);
            font-weight: 700; font-size: 24px; margin: 0;
        }

        .main-content { padding: 20px 0 40px 0; }

        .top-nav-container {
            margin-bottom: 30px; padding-bottom: 20px;
            border-bottom: 1px solid var(--border-octonary);
        }

        .top-nav-header {
            display: flex; align-items: flex-end; justify-content: space-between;
            margin-bottom: 15px; flex-wrap: wrap; gap: 10px;
        }

        .top-nav-header h4 { font-weight: 700; margin: 0; }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px; margin-top: 15px;
        }

        .sidebar-btn {
            display: flex; align-items: center; justify-content: center;
            height: 60px; padding: 10px;
            background-color: var(--background-senary);
            border: 1px solid var(--border-octonary);
            border-bottom: 3px solid var(--border-primary);
            color: var(--color-tertiary);
            font-weight: 600; font-size: 13px; text-align: center;
            transition: all 0.2s ease;
            text-decoration: none !important;
            border-radius: 4px; cursor: pointer;
        }

        .sidebar-btn i {
            margin-right: 12px; font-size: 18px;
            color: var(--color-septenary); width: 25px; text-align: center;
        }

        .sidebar-btn:hover {
            background-color: #fff; border-color: var(--border-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .sidebar-btn.active {
            background-color: var(--background-primary);
            color: #fff; border-color: var(--border-primary);
        }

        .sidebar-btn.active i { color: #fff; }

        .search-container { margin-bottom: 25px; }
        .search-container .input-group { max-width: 400px; }

        .search-container input {
            height: 40px; border-radius: 20px 0 0 20px !important;
            padding-left: 20px; border: 1px solid var(--border-octonary);
            box-shadow: none; font-family: "Montserrat", sans-serif;
        }

        .search-container .btn {
            height: 40px; border-radius: 0 20px 20px 0 !important;
            border: 1px solid var(--border-octonary); border-left: none;
            background-color: #f8f8f8;
        }

        .search-container input:focus { border-color: var(--color-septenary); box-shadow: none; }

        .instruction-card {
            background-color: #fff; border: 1px solid var(--border-octonary);
            padding: 40px; border-radius: 4px; min-height: 500px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .instruction-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .instruction-content.active { display: block; }

        h2.offset {
            font-weight: bold; font-size: 26px;
            color: var(--color-septenary);
            border-bottom: 4px solid var(--color-septenary);
            margin-bottom: 30px; padding-bottom: 10px;
        }

        .category-header {
            background-color: var(--color-septenary); color: #fff;
            padding: 10px 15px; margin: 30px 0 15px 0;
            border-radius: 4px; font-size: 16px;
            font-weight: 700; text-transform: uppercase;
        }

        .category-header:first-of-type { margin-top: 0; }

        .qa-block {
            margin-bottom: 20px; padding: 15px; padding-bottom: 20px;
            border-bottom: 1px dashed var(--border-octonary);
            border-radius: 4px; transition: background-color 0.2s;
        }

        .qa-block:last-child { border-bottom: none; }
        .qa-block:hover { background-color: #fafafa; }

        .question {
            font-weight: 700; color: var(--color-tertiary);
            margin-bottom: 8px; font-size: 15px; display: block;
        }

        .question i { color: var(--color-septenary); margin-right: 8px; }

        .answer {
            color: var(--color-quaternary); line-height: 1.8;
            margin-left: 24px; display: block; font-size: 14px;
        }

        .admin-link {
            display: inline-flex; align-items: center;
            padding: 8px 16px; background-color: var(--color-septenary);
            color: #fff !important; border-radius: 4px;
            font-size: 12px; font-weight: 600;
            text-decoration: none !important;
            transition: all 0.2s; gap: 6px;
        }

        .admin-link:hover { background-color: var(--color-senary); transform: translateY(-1px); }

        .loading-spinner {
            text-align: center; padding: 60px 0; grid-column: 1 / -1;
        }

        .loading-spinner i { color: var(--color-septenary); margin-bottom: 15px; display: block; }

        mark { background-color: #fff3cd; padding: 1px 4px; border-radius: 2px; }

        footer .cxRodape {
            background-color: #fff;
            border-top: 1px solid var(--border-octonary);
            border-bottom: 5px solid #000;
            padding: 20px 0; margin-top: 60px;
        }

        footer .cxRodape p { font-size: 13px; line-height: 16px; font-weight: 500; color: #000; margin: 0; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media screen and (max-width: 991px) {
            .instruction-card { padding: 20px; }
            .header-title-container { flex-direction: column; align-items: flex-start; gap: 10px; }
            .portal-title { font-size: 18px; }
        }

        @media screen and (max-width: 576px) {
            .topic-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <nav class="navbar-custom navbar navbar-default">
            <div class="container">
                <div class="navbar-header">
                    <a href="https://www.saopaulo.sp.gov.br">
                        <img src="https://saopaulo.sp.gov.br/barra-govsp/img/logo-governo-do-estado-sp.png" alt="Governo de São Paulo" height="38">
                    </a>
                </div>
            </div>
        </nav>
        <div class="header-main">
            <div class="container">
                <div class="header-title-container">
                    <a href="/">
                        <img src="https://atendimento.educacao.sp.gov.br/atendimento_seduc.png" alt="Portal de Atendimento" style="height: 85px;">
                    </a>
                    <h1 class="portal-title">Portal de Instruções COGESPA</h1>
                </div>
            </div>
        </div>
    </header>

    <div class="main-content">
        <div class="container">
            <div class="top-nav-container">
                <div class="top-nav-header">
                    <h4>Selecione o Assunto da sua dúvida <samp style="color: red;">*</samp></h4>
                    <a href="admin.html" class="admin-link"><i class="fa fa-lock"></i> Área Admin</a>
                </div>

                <div class="search-container">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="Buscar pergunta ou resposta..." onkeyup="filterContent()">
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button" onclick="filterContent()"><i class="fa fa-search"></i></button>
                        </span>
                    </div>
                </div>

                <div class="topic-grid" id="topicGrid">
                    <div class="loading-spinner">
                        <i class="fa fa-spinner fa-spin fa-3x"></i>
                        <p>Carregando tópicos...</p>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="instruction-card">
                        <div id="welcome" class="instruction-content active text-center" style="padding-top: 100px;">
                            <i class="fa fa-info-circle fa-5x" style="color: var(--color-septenary); opacity: 0.3; margin-bottom: 20px;"></i>
                            <h2 style="color: var(--color-senary);">Bem-vindo ao Portal de Instruções COGESPA</h2>
                            <p style="font-size: 18px; color: var(--color-quaternary); max-width: 600px; margin: 0 auto;">
                                Selecione um dos assuntos acima para visualizar as orientações e procedimentos.
                            </p>
                        </div>
                        <div id="searchResults" class="instruction-content">
                            <h2 class="offset"><i class="fa fa-search" style="margin-right: 10px;"></i>Resultados da Busca</h2>
                            <div id="searchResultsContent"></div>
                        </div>
                        <div id="dynamicContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="cxRodape">
            <div class="container">
                <p>Secretaria da Educação do Estado de São Paulo - COGESPA</p>
                <p style="font-size: 11px; margin-top: 5px;">&copy; 2026 Portal de Atendimento – SEDUC</p>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    // ================================================================
    // CONFIGURACAO - URL DA API NA SUA VPS
    // ================================================================
    const API_BASE = 'https://api-cogespa.projdev.site';
    // ================================================================

    let portalData = { topicos: [] };
    let currentTopic = null;

    function loadData() {
        $.getJSON(API_BASE + '/api/dados')
            .done(function(data) {
                portalData = data;
                renderTopicButtons();
                renderTopicContents();
            })
            .fail(function() {
                $('#topicGrid').html(
                    '<div style="text-align:center; grid-column:1/-1; padding:40px;">' +
                    '<i class="fa fa-exclamation-triangle fa-3x" style="color:#e74c3c; display:block; margin-bottom:15px;"></i>' +
                    '<p style="color:#e74c3c; font-weight:700;">Erro ao carregar dados.</p>' +
                    '<p style="color:var(--color-quaternary);">Verifique a conexao com o servidor.</p>' +
                    '<button onclick="loadData()" style="margin-top:10px; padding:8px 20px; background:var(--color-septenary); color:#fff; border:none; border-radius:4px; cursor:pointer; font-family:Montserrat,sans-serif;">Tentar Novamente</button>' +
                    '</div>'
                );
            });
    }

    function renderTopicButtons() {
        var html = '';
        portalData.topicos.forEach(function(t) {
            html += '<a href="javascript:void(0)" class="sidebar-btn" onclick="showTopic(\'' + escAttr(t.id) + '\', this)">';
            html += '<i class="fa ' + escAttr(t.icone || 'fa-file-o') + '"></i> ' + esc(t.nome);
            html += '</a>';
        });
        $('#topicGrid').html(html || '<p style="grid-column:1/-1; text-align:center; color:#999;">Nenhum topico cadastrado.</p>');
    }

    function renderTopicContents() {
        var html = '';
        portalData.topicos.forEach(function(t) {
            html += '<div id="' + escAttr(t.id) + '" class="instruction-content">';
            html += '<h2 class="offset">' + esc(t.nome) + '</h2>';
            (t.categorias || []).forEach(function(cat) {
                html += '<div class="category-header">' + esc(cat.nome) + '</div>';
                (cat.perguntas || []).forEach(function(qa) {
                    html += '<div class="qa-block">';
                    html += '<span class="question"><i class="fa fa-question-circle"></i>' + esc(qa.pergunta) + '</span>';
                    html += '<span class="answer">' + formatAnswer(qa.resposta) + '</span>';
                    html += '</div>';
                });
            });
            html += '</div>';
        });
        $('#dynamicContent').html(html);
    }

    function showTopic(topicId, btn) {
        currentTopic = topicId;
        $('#searchInput').val('');
        $('.instruction-content').removeClass('active');
        $('#' + topicId).addClass('active');
        $('.sidebar-btn').removeClass('active');
        $(btn).addClass('active');
        if ($(window).width() < 992) {
            $('html, body').animate({ scrollTop: $(".instruction-card").offset().top - 20 }, 400);
        }
    }

    function filterContent() {
        var term = $('#searchInput').val().toLowerCase().trim();
        if (!term) {
            $('#searchResults').removeClass('active');
            if (currentTopic) {
                $('.instruction-content').removeClass('active');
                $('#' + currentTopic).addClass('active');
            } else {
                $('.instruction-content').removeClass('active');
                $('#welcome').addClass('active');
            }
            return;
        }

        var results = [];
        portalData.topicos.forEach(function(t) {
            (t.categorias || []).forEach(function(cat) {
                (cat.perguntas || []).forEach(function(qa) {
                    if (qa.pergunta.toLowerCase().indexOf(term) !== -1 ||
                        qa.resposta.toLowerCase().indexOf(term) !== -1 ||
                        cat.nome.toLowerCase().indexOf(term) !== -1 ||
                        t.nome.toLowerCase().indexOf(term) !== -1) {
                        results.push({ topico: t.nome, categoria: cat.nome, pergunta: qa.pergunta, resposta: qa.resposta });
                    }
                });
            });
        });

        var html = '';
        if (results.length === 0) {
            html = '<div style="text-align:center; padding:40px; color:#999;">Nenhum resultado para "<strong>' + esc(term) + '</strong>".</div>';
        } else {
            html += '<p style="color:var(--color-quaternary); margin-bottom:20px;">' + results.length + ' resultado(s)</p>';
            results.forEach(function(item) {
                html += '<div class="qa-block">';
                html += '<span style="font-size:11px; color:var(--color-septenary); font-weight:700; text-transform:uppercase; display:block; margin-bottom:5px;">';
                html += '<i class="fa fa-tag" style="margin-right:4px;"></i>' + esc(item.topico) + ' &rsaquo; ' + esc(item.categoria) + '</span>';
                html += '<span class="question"><i class="fa fa-question-circle"></i>' + highlight(esc(item.pergunta), term) + '</span>';
                html += '<span class="answer">' + highlight(formatAnswer(item.resposta), term) + '</span>';
                html += '</div>';
            });
        }

        $('#searchResultsContent').html(html);
        $('.instruction-content').removeClass('active');
        $('.sidebar-btn').removeClass('active');
        $('#searchResults').addClass('active');
    }

    function formatAnswer(text) {
        if (!text) return '';
        return esc(text).replace(/\\n/g, '<br>').replace(/\n/g, '<br>');
    }

    function highlight(text, term) {
        if (!term) return text;
        var regex = new RegExp('(' + term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }

    function esc(str) { return str ? $('<span>').text(str).html() : ''; }
    function escAttr(str) { return str ? str.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;') : ''; }

    $(document).ready(function() {
        loadData();
        $('#searchInput').on('keydown', function(e) { if (e.key === 'Escape') { $(this).val(''); filterContent(); } });
    });
    </script>
</body>
</html>
